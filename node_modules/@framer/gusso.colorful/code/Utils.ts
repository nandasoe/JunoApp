import { Color } from 'framer'

const modulate = (value, rangeA, rangeB) => {
  const [fromLow, fromHigh] = rangeA
  const [toLow, toHigh] = rangeB
  return toLow + ((value - fromLow) / (fromHigh - fromLow)) * (toHigh - toLow)
}

export const toP3 = color => {
  const colorInput = Color(color)
  const colorResult = { r: 0, g: 0, b: 0, a: colorInput.a }

  Array('r', 'g', 'b').forEach(key => {
    colorResult[key] = modulate(colorInput[key], [0, 255], [0, 1]).toFixed(3)
  })

  const finalColor = `color(display-p3
      ${colorResult.r}
      ${colorResult.g}
      ${colorResult.b}
    / ${colorResult.a})`

  return CSS.supports('color: color(display-p3)') ? finalColor : color
}
